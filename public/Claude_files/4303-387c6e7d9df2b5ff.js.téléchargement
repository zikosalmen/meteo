"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4303],{34303:(e,n,t)=>{t.d(n,{r:()=>p});var a=t(54568),r=t(23353),s=t(64585),l=t(9428),o=t(262),c=t(7620),d=t(23700);let i=c.forwardRef((e,n)=>{let{content:t,onScreenshot:i}=e,[p,u]=(0,c.useState)([]),g=(0,c.useRef)(null),h=(0,r.pc)(g,n);(0,c.useEffect)(()=>{let e=e=>{let n=e.data;if(n&&"screenshotData"===n.type&&(null==i||i({success:!0,screenshot:n.data})),n&&"screenshotError"===n.type&&(null==i||i({success:!1,error:n.error})),n&&"console"===n.type&&n.message&&u(e=>[...e,n.message]),n&&"claudeComplete"===n.type&&window.claude.complete(n.prompt).then(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"claudeComplete",completion:e,id:n.id},"*")}).catch(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"claudeComplete",error:e instanceof Error?e.message:String(e),id:n.id},"*")}),n&&"openExternal"===n.type&&window.claude.openExternal(n.href),n&&"downloadFile"===n.type&&window.claude.downloadFile(n),n&&"proxyFetch"===n.type){let{channelId:e}=n;fetch(n.url,n.init).then(async t=>{var a,r,s,l,o,c,d,i,p,u;if(null==(r=g.current)||null==(a=r.contentWindow)||a.postMessage({type:"proxyFetchResponse",id:n.id,headers:Object.fromEntries(t.headers.entries()),status:t.status,statusText:t.statusText},"*"),t.body&&e){let n=t.body.getReader();try{let t=!1;for(;!t;){let a=await n.read();(t=a.done)?null==(l=g.current)||null==(s=l.contentWindow)||s.postMessage({type:"proxyFetchStream",channelId:e,done:!0},"*"):a.value&&(null==(c=g.current)||null==(o=c.contentWindow)||o.postMessage({type:"proxyFetchStream",channelId:e,chunk:a.value.buffer},"*",[a.value.buffer]))}}catch(n){null==(i=g.current)||null==(d=i.contentWindow)||d.postMessage({type:"proxyFetchStream",channelId:e,error:n instanceof Error?n.message:String(n)},"*")}finally{n.releaseLock()}}else!t.body&&e&&(null==(u=g.current)||null==(p=u.contentWindow)||p.postMessage({type:"proxyFetchStream",channelId:e,done:!0},"*"))}).catch(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"proxyFetchResponse",id:n.id,error:e instanceof Error?e.message:String(e)},"*")})}n&&"storageGet"===n.type?window.storage.get(n.key,n.shared).then(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"storageGet",result:e,id:n.id},"*")}).catch(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"storageGet",error:e instanceof Error?e.message:String(e),id:n.id},"*")}):n&&"storageSet"===n.type?window.storage.set(n.key,n.value,n.shared).then(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"storageSet",result:e,id:n.id},"*")}).catch(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"storageSet",error:e instanceof Error?e.message:String(e),id:n.id},"*")}):n&&"storageDelete"===n.type?window.storage.delete(n.key,n.shared).then(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"storageDelete",result:e,id:n.id},"*")}).catch(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"storageDelete",error:e instanceof Error?e.message:String(e),id:n.id},"*")}):n&&"storageList"===n.type&&window.storage.list(n.prefix,n.shared).then(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"storageList",result:e,id:n.id},"*")}).catch(e=>{var t,a;null==(a=g.current)||null==(t=a.contentWindow)||t.postMessage({type:"storageList",error:e instanceof Error?e.message:String(e),id:n.id},"*")})};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[i]);let w=t.replace("<head>","<head>".concat("\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.13/html-to-image.min.js\" integrity=\"sha512-iZ2ORl595Wx6miw+GuadDet4WQbdSWS3JLMoNfY8cRGoEFy6oT3G9IbcrBeL6AfkgpA51ETt/faX6yLV+/gFJg==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"><\/script>\n    <script>\n      (function() {\n        const originalConsole = window.console;\n        window.console = {\n          log: (...args) => {\n            originalConsole.log(...args);\n            window.parent.postMessage({ type: 'console', message: args.join(' ') }, '*');\n          },\n          error: (...args) => {\n            originalConsole.error(...args);\n            window.parent.postMessage({ type: 'console', message: 'Error: ' + args.join(' ') }, '*');\n          },\n          warn: (...args) => {\n            originalConsole.warn(...args);\n            window.parent.postMessage({ type: 'console', message: 'Warning: ' + args.join(' ') }, '*');\n          }\n        };\n\n        let requestId = 0;\n        let callbacksMap = new Map();\n        let streamControllers = new Map();\n        \n        window.claude = {\n          complete: (prompt) => {\n            return new Promise((resolve, reject) => {\n              const id = requestId++;\n              callbacksMap.set(id, { resolve, reject });\n              window.parent.postMessage({ type: 'claudeComplete', id, prompt }, '*');\n            });\n          }\n        };\n\n        window.storage = {\n          get: (key, shared = false) => {\n            return new Promise((resolve, reject) => {\n              const id = requestId++;\n              callbacksMap.set(id, { resolve, reject });\n              window.parent.postMessage({ type: 'storageGet', id, key, shared }, '*');\n            });\n          },\n          set: (key, value, shared = false) => {\n            return new Promise((resolve, reject) => {\n              const id = requestId++;\n              callbacksMap.set(id, { resolve, reject });\n              window.parent.postMessage({ type: 'storageSet', id, key, value, shared }, '*');\n            });\n          },\n          delete: (key, shared = false) => {\n            return new Promise((resolve, reject) => {\n              const id = requestId++;\n              callbacksMap.set(id, { resolve, reject });\n              window.parent.postMessage({ type: 'storageDelete', id, key, shared }, '*');\n            });\n          },\n          list: (prefix, shared = false) => {\n            return new Promise((resolve, reject) => {\n              const id = requestId++;\n              callbacksMap.set(id, { resolve, reject });\n              window.parent.postMessage({ type: 'storageList', id, prefix, shared }, '*');\n            });\n          }\n        };\n\n        let pendingBlobs = new Map();\n        URL.createObjectURL = (blob) => {\n          // Store the blob and create an ID and URL for it\n          const blobId = `blob-${Date.now()}-${Math.random()}`;\n          pendingBlobs.set(blobId, blob);\n          return `blob-request://${blobId}`;\n        };\n\n        URL.revokeObjectURL = (url) => {\n          // Remove the blob from our store\n          const blobId = url.replace(\"blob-request://\", \"\");\n          pendingBlobs.delete(blobId);\n        };\n\n        const getBlobFromURL = (url) => {\n          const blobId = url.replace(\"blob-request://\", \"\");\n          return pendingBlobs.get(blobId);\n        };\n\n        // Override global fetch with streaming support\n        window.fetch = (url, init = {}) => {\n          return new Promise((resolve, reject) => {\n            const id = requestId++;\n            const channelId = `fetch-${id}-${Date.now()}`;\n            \n            callbacksMap.set(id, { \n              resolve: (response) => {\n                // Create a ReadableStream for the response body\n                const stream = new ReadableStream({\n                  start(controller) {\n                    streamControllers.set(channelId, controller);\n                  },\n                  cancel() {\n                    streamControllers.delete(channelId);\n                  }\n                });\n                \n                // Create and return the Response with the stream\n                resolve(new Response(stream, {\n                  status: response.status,\n                  statusText: response.statusText,\n                  headers: response.headers\n                }));\n              },\n              reject,\n              channelId\n            });\n            \n            window.parent.postMessage({\n              type: 'proxyFetch',\n              id,\n              url,\n              init,\n              channelId\n            }, '*');\n          });\n        };\n\n        window.addEventListener('message', async (event) => {\n          if (event.data.type === 'takeScreenshot') {\n            const rootElement = document.getElementById('artifacts-component-root-html');\n            if (!rootElement) {\n              window.parent.postMessage({\n                type: 'screenshotError',\n                error: new Error('Root element not found'),\n              }, '*');\n            }\n            const screenshot = await htmlToImage.toPng(rootElement, {\n              imagePlaceholder:\n                \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjePDgwX8ACOQDoNsk0PMAAAAASUVORK5CYII=\",\n            });\n            window.parent.postMessage({\n              type: 'screenshotData',\n              data: screenshot,\n            }, '*');\n          } else if (event.data.type === 'claudeComplete') {\n            const callback = callbacksMap.get(event.data.id);\n            if (event.data.error) {\n              callback.reject(new Error(event.data.error));\n            } else {\n              callback.resolve(event.data.completion);\n            }\n            callbacksMap.delete(event.data.id);\n          } else if (event.data.type === 'proxyFetchResponse') {\n            const callback = callbacksMap.get(event.data.id);\n            if (event.data.error) {\n              callback.reject(new Error(event.data.error));\n              callbacksMap.delete(event.data.id);\n            } else {\n              // Initial response with headers, status, etc.\n              callback.resolve({\n                status: event.data.status,\n                statusText: event.data.statusText,\n                headers: event.data.headers\n              });\n              // Don't delete the callback yet if streaming\n              if (!event.data.body) {\n                callbacksMap.delete(event.data.id);\n              }\n            }\n          } else if (event.data.type === 'proxyFetchStream') {\n            // Handle streaming data chunks\n            const controller = streamControllers.get(event.data.channelId);\n            if (controller) {\n              if (event.data.error) {\n                controller.error(new Error(event.data.error));\n                streamControllers.delete(event.data.channelId);\n              } else if (event.data.done) {\n                controller.close();\n                streamControllers.delete(event.data.channelId);\n                // Clean up the callback\n                const callback = Array.from(callbacksMap.entries()).find(\n                  ([_, value]) => value.channelId === event.data.channelId\n                );\n                if (callback) {\n                  callbacksMap.delete(callback[0]);\n                }\n              } else if (event.data.chunk) {\n                controller.enqueue(new Uint8Array(event.data.chunk));\n              }\n            }\n          } else if (event.data.type === 'storageGet') {\n            const callback = callbacksMap.get(event.data.id);\n            if (event.data.error) {\n              callback.reject(new Error(event.data.error));\n            } else {\n              callback.resolve(event.data.result);\n            }\n            callbacksMap.delete(event.data.id);\n          } else if (event.data.type === 'storageSet') {\n            const callback = callbacksMap.get(event.data.id);\n            if (event.data.error) {\n              callback.reject(new Error(event.data.error));\n            } else {\n              callback.resolve(event.data.result);\n            }\n            callbacksMap.delete(event.data.id);\n          } else if (event.data.type === 'storageDelete') {\n            const callback = callbacksMap.get(event.data.id);\n            if (event.data.error) {\n              callback.reject(new Error(event.data.error));\n            } else {\n              callback.resolve(event.data.result);\n            }\n            callbacksMap.delete(event.data.id);\n          } else if (event.data.type === 'storageList') {\n            const callback = callbacksMap.get(event.data.id);\n            if (event.data.error) {\n              callback.reject(new Error(event.data.error));\n            } else {\n              callback.resolve(event.data.result);\n            }\n            callbacksMap.delete(event.data.id);\n          }\n        });\n\n        window.addEventListener('click', (event) => {\n          const isEl = event.target instanceof HTMLElement;\n          if (!isEl) return;\n    \n          // find ancestor links\n          const linkEl = event.target.closest(\"a\");\n          if (!linkEl || !linkEl.href) return;\n    \n          event.preventDefault();\n          event.stopImmediatePropagation();\n    \n          if (linkEl.href.startsWith(\"blob-request:\")) {\n            const blob = getBlobFromURL(linkEl.href);\n            if (!blob) return;\n            void blob.arrayBuffer().then((data) => {\n              window.parent.postMessage({\n                type: \"downloadFile\",\n                filename: linkEl.download,\n                data,\n                mimeType: blob.type || \"application/octet-stream\",\n              });\n            });\n          } else if (linkEl.href.startsWith(\"data:\")) {\n            const [header, base64Data] = linkEl.href.split(\",\");\n            const mimeMatch = header.match(/data:([^;]+)/);\n            const mimeType = mimeMatch ? mimeMatch[1] : \"application/octet-stream\";\n            const binaryString = atob(base64Data);\n            const data = Uint8Array.from(binaryString, (c) =>\n              c.charCodeAt(0),\n            ).buffer;\n            window.parent.postMessage({\n              type: \"downloadFile\",\n              filename: linkEl.download,\n              data,\n              mimeType,\n            });\n          } else {\n            let linkUrl;\n            try {\n              linkUrl = new URL(linkEl.href);\n            } catch (error) {\n              return;\n            }\n    \n            if (linkUrl.hostname === window.location.hostname) return;\n      \n            window.parent.postMessage({\n              type: 'openExternal',\n              href: linkEl.href,\n            }, '*');\n          }\n      });\n\n        const originalOpen = window.open;\n        window.open = function (url) {\n          window.parent.postMessage({\n            type: \"openExternal\",\n            href: url,\n          }, \"*\");\n        };\n\n        window.addEventListener('error', (event) => {\n          window.parent.postMessage({ type: 'console', message: 'Uncaught Error: ' + event.message }, '*');\n        });\n      })();\n    <\/script>\n  "));return w=w.replace(/<body(\s[^>]*)?>/i,e=>{let n=e.slice(5,-1);return"<body".concat(n,' id="artifacts-component-root-html">')}),(0,a.jsxs)(d.ResizablePanelGroup,{direction:"vertical",className:"h-screen",children:[(0,a.jsx)(d.ResizablePanel,{defaultSize:p.length>0?80:100,children:(0,a.jsx)("iframe",{ref:h,className:"h-full w-full",sandbox:"allow-scripts allow-same-origin",allow:"clipboard-write",srcDoc:w})}),p.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.ResizableHandle,{withHandle:!0}),(0,a.jsx)(d.ResizablePanel,{defaultSize:20,children:(0,a.jsxs)("div",{className:"h-full overflow-auto p-4",style:{backgroundColor:"hsl(60 1.8% 22%)",backgroundImage:"linear-gradient(hsl(60 3.3% 17.8%), hsl(45 4.9% 16.1%))"},children:[(0,a.jsxs)("div",{className:"mb-2 inline-flex items-center gap-2 rounded-lg border px-2 py-1",style:{borderColor:"hsl(50 5.9% 40%)",color:"hsl(47 8.4% 79%)"},children:[(0,a.jsx)(s.A,{size:12}),(0,a.jsx)("h2",{className:"gap-2 font-ui text-xs",children:"Console Messages"})]}),p.map((e,n)=>{let t=null,r={},s={color:"hsl(50 23.1% 94.9%)"};return e.startsWith("Error:")||e.startsWith("Uncaught Error:")?(t=(0,a.jsx)(l.A,{size:12,className:"mt-1 shrink-0 text-red-500"}),r={backgroundColor:"rgba(255, 0, 0, 0.1)"},s.color="hsl(5 69.4% 72.9%)"):e.startsWith("Warning:")&&(t=(0,a.jsx)(o.A,{size:12,className:"mt-1 shrink-0 text-yellow-500"}),r={backgroundColor:"rgba(255, 255, 0, 0.1)"},s.color="hsl(18 50.4% 47.5%)"),(0,a.jsxs)("div",{className:"mb-0.5 flex items-start gap-2 rounded-lg px-2 py-1",style:r,children:[(0,a.jsx)(a.Fragment,{children:t}),(0,a.jsx)("pre",{className:"flex-grow text-wrap font-mono text-sm",style:s,children:e})]},n)})]})})]})]})});i.displayName="UnsafeHtmlRenderer";let p=c.memo(i)}}]);